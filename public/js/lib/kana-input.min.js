"use strict";(function(){var a=this,t=function(a){return{insert:function(t,e){return t=t||"",e=Math.max(0,Math.min(e,a.length)),a.substr(0,e)+t+a.substr(e)},remove:function(t,e){return t=Math.min(t,e),e=Math.max(0,Math.min(e,a.length)),a.substr(0,e-t)+a.substr(e)},setCaretPosition:function(t){if(a.setSelectionRange)a.setSelectionRange(t,t);else if(a.createTextRange){var e=a.createTextRange();e.collapse(!0),e.moveEnd("character",t),e.moveStart("character",t),e.select()}}}},e=a.kanaInput={utils:t,romajis:"a i u e o ka ki ku ke ko sa shi su se so ta chi tsu te to na ni nu ne no ha hi fu he ho ma mi mu me mo ya yu yo ra ri ru re ro wa wo n ga gi gu ge go za ji zu ze zo da ji zu de do ba bi bu be bo pa pi pu pe po kya kyu kyo gya gyu gyo sha shu sho ja ju jo cha chu cho nya nyu nyo hya hyu hyo bya byu byo pya pyu pyo mya myu myo rya ryu ryo".split(" "),isRomaji:function(a){return-1!==e.romajis.indexOf(a)},isSpecialRomaji:function(a){var t=null!=a.match(/^[んン][aieuo]$/),n=a.match(/^([kstcnhfmyrwgzjdbp])\1/)&&e.isRomaji(a.substr(1));return t||n},hiraganas:"あ い う え お か き く け こ さ し す せ そ た ち つ て と な に ぬ ね の は ひ ふ へ ほ ま み む め も や ゆ よ ら り る れ ろ わ を ん が ぎ ぐ げ ご ざ じ ず ぜ ぞ だ ぢ づ で ど ば び ぶ べ ぼ ぱ ぴ ぷ ぺ ぽ きゃ きゅ きょ ぎゃ ぎゅ ぎょ しゃ しゅ しょ じゃ じゅ じょ ちゃ ちゅ ちょ にゃ にゅ にょ ひゃ ひゅ ひょ びゃ びゅ びょ ぴゃ ぴゅ ぴょ みゃ みゅ みょ りゃ りゅ りょ".split(" "),isHiragana:function(a){return-1!==e.hiraganas.indexOf(a)},katakanas:"ア イ ウ エ オ カ キ ク ケ コ サ シ ス セ ソ タ チ ツ テ ト ナ ニ ヌ ネ ノ ハ ヒ フ ヘ ホ マ ミ ム メ モ ヤ ユ ヨ ラ リ ル レ ロ ワ ヲ ン ガ ギ グ ゲ ゴ ザ ジ ズ ゼ ゾ ダ ヂ ヅ デ ド バ ビ ブ ベ ボ パ ピ プ ペ ポ キャ キュ キョ ギャ ギュ ギョ シャ シュ ショ ジャ ジュ ジョ チャ チュ チョ ニャ ニュ ニョ ヒャ ヒュ ヒョ ビャ ビュ ビョ ピャ ピュ ピョ ミャ ミュ ミョ リャ リュ リョ".split(" "),isKatakana:function(a){return-1!==e.katakanas.indexOf(a)},isKana:function(a){return e.isHiragana(a)||e.isKatakana(a)},isSpecialKana:function(a){var t=("っ"===a[0]||"ッ"===a[0])&&e.isKana(a.substr(1));return t},kanaToRomaji:function(a){var t;return"っ"===a[0]&&e.isKana(a.substr(1))&&(t=e.romajis[e.hiraganas.indexOf(a.substr(1))]),"ッ"===a[0]&&e.isKana(a.substr(1))&&(t=e.romajis[e.katakanas.indexOf(a.substr(1))]),t=t?t[0]+t:e.romajis[e.hiraganas.indexOf(a)]||e.romajis[e.katakanas.indexOf(a)]},romajiToHiragana:function(a){return"ん"===a[0]&&(a="n"+a.substr(1)),a.match(/^([kstcnhfmyrwgzjdbp])\1/)&&e.isRomaji(a.substr(1))?(a="n"+a.substr(1),"っ"+e.hiraganas[e.romajis.indexOf(a.substr(1))]):e.hiraganas[e.romajis.indexOf(a)]},romajiToKatakana:function(a){return"ン"===a[0]&&(a="n"+a.substr(1)),a.match(/^([kstcnhfmyrwgzjdbp])\1/)&&e.isRomaji(a.substr(1))?"ッ"+e.katakanas[e.romajis.indexOf(a.substr(1))]:e.katakanas[e.romajis.indexOf(a)]},insertNewLetter:function(a,n,r,i,s){for(var o,u=t(n).insert(i,r),c=r+1,h=u.substring(0,c);h.length>0&&!e.isRomaji(h)&&!e.isSpecialRomaji(h);)h=h.substr(1);h.length>0&&(u=t(u).remove(h.length,c),c-=h.length,"hiragana"===a&&(o=e.romajiToHiragana(h)),"katakana"===a&&(o=e.romajiToKatakana(h)),u=t(u).insert(o,c),c+=o.length),s(u,c)},removeLetter:function(a,n,r){for(var i,s=a,o=n,u=s.substring(0,o);u.length>0&&!e.isKana(u)&&!e.isSpecialKana(u);)u=u.substr(1);u.length>0&&(s=t(s).remove(u.length,o),o-=u.length,i=e.kanaToRomaji(u),i.match(/^n[aieuo]$/)&&(i=e.isHiragana(u)?"ん"+i[1]:"ン"+i[1]),s=t(s).insert(i,o),o+=i.length),s=t(s).remove(1,o),o-=1,r(s,o)}};a.onkeypress=function(a){var n=a.target,r=n.dataset?n.dataset.kanaInput:!1;if(!(""!==r&&"true"!==r||a.metaKey||a.altKey||a.ctrlKey)){var i=n.selectionStart,s=n.selectionEnd-n.selectionStart,o=n.value.toLowerCase(),u=String.fromCharCode(a.charCode),c=function(a,e){n.value=a,t(n).setCaretPosition(e)};if(u>="A"&&"z">=u){a.preventDefault();var h="Z">=u?"katakana":"hiragana";u=u.toLowerCase(),s>0&&(o=t(o).remove(s,i+s)),e.insertNewLetter(h,o,i,u,c)}"."===u&&(a.preventDefault(),e.insertNewLetter("hiragana",o,i,"。",c)),"-"===u&&(a.preventDefault(),e.insertNewLetter("hiragana",o,i,"ー",c))}},a.onkeydown=function(a){var n=a.target,r=n.dataset?n.dataset.kanaInput:!1;if(!(""!==r&&"true"!==r||a.metaKey||a.altKey||a.ctrlKey)){var i=n.selectionStart,s=n.selectionEnd-n.selectionStart,o=n.value.toLowerCase(),u=function(a,e){n.value=a,t(n).setCaretPosition(e)};8===a.keyCode&&0!==i&&0===s&&(a.preventDefault(),e.removeLetter(o,i,u))}},a.onkeyup=function(a){var t=a.target,e=t.dataset?t.dataset.kanaInput:!1}}).call(this);